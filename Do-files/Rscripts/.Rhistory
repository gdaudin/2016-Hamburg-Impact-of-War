fhotelling$customs_region =="Nantes"),]
fhotelling = fhotelling[fhotelling$year==1714,]
fhotelling = fhotelling[(fhotelling$best_guess_region_prodxpart !=1 &
fhotelling$source_tout_region!=1 &
fhotelling$year!=1789),]
library(dplyr)
library(ggplot2)
library(ggpubr)
library(extrafont)
library(ggthemes)
library(tidyverse)
library(whoami)
library(zoo)
loadfonts()
if(username()=="Tirindelli"){
HamburgPaperDir = "/Users/Tirindelli/Desktop/HamburgPaper/"
HamburgDir = "/Volumes/GoogleDrive/My Drive/Hamburg/"
}
RscriptDir = "Do-files/Rscripts/"
GraphDir = "Graphs/"
DataframeDir = "Dataframe/"
NewgraphsDir = "New graphs/"
PaperDir = "Paper - Impact of War/Paper/"
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
fhotelling = hotelling
direction = "national"
X_I = "X"
classification = "sitc"
period = ""
if(period=="pre1795") fhotelling = fhotelling[fhotelling$year<1795,]
if(direction=="national"){
if(classification=="sitc"){
names(fhotelling)[names(fhotelling) == "product_sitc_simplEN"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="sitc_aggr"){
names(fhotelling)[names(fhotelling) == "sitc_aggr"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="partner_grouping_8"){
names(fhotelling)[names(fhotelling) == "partner_grouping_8"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
}
fhotelling = mutate(fhotelling, pour_calcul_national = best_guess_national_partner*value)
fhotelling = fhotelling %>% group_by(year, export_import) %>% mutate(commerce_national = sum(pour_calcul_national, na.rm = TRUE))
fhotelling$pour_calcul_national = NULL
fhotelling$source_tout_region_one = ifelse(
(fhotelling$source_type=="National toutes directions tous partenaires" |
fhotelling$source_type=="National toutes directions sans produits"), 1, 0)
fhotelling = fhotelling %>% group_by(year) %>%
mutate(source_tout_region = max(source_tout_region_one, na.rm = TRUE))
fhotelling = fhotelling[(fhotelling$source_tout_region==1 &
fhotelling$source_type != "National toutes directions tous partenaires" &
fhotelling$source_type !="National toutes directions sans produits"),]
fhotelling = fhotelling[(fhotelling$source_tout_region==1 &
fhotelling$source_type != "National toutes directions tous partenaires" &
fhotelling$source_type !="National toutes directions sans produits"),]
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
fhotelling = hotelling
if(period=="pre1795") fhotelling = fhotelling[fhotelling$year<1795,]
if(direction=="national"){
if(classification=="sitc"){
names(fhotelling)[names(fhotelling) == "product_sitc_simplEN"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="sitc_aggr"){
names(fhotelling)[names(fhotelling) == "sitc_aggr"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="partner_grouping_8"){
names(fhotelling)[names(fhotelling) == "partner_grouping_8"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
}
if(direction=="regional"){
#Computing total trade
fhotelling = mutate(fhotelling, pour_calcul_national = best_guess_national_partner*value)
fhotelling = fhotelling %>% group_by(year, export_import) %>% mutate(commerce_national = sum(pour_calcul_national, na.rm = TRUE))
fhotelling$pour_calcul_national = NULL
fhotelling$source_tout_region_one = ifelse(
(fhotelling$source_type=="National toutes directions tous partenaires" |
fhotelling$source_type=="National toutes directions sans produits"), 1, 0)
fhotelling = fhotelling %>% group_by(year) %>%
mutate(source_tout_region = max(source_tout_region_one, na.rm = TRUE))
}
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
fhotelling = hotelling
if(direction=="national"){
if(classification=="sitc"){
names(fhotelling)[names(fhotelling) == "product_sitc_simplEN"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="sitc_aggr"){
names(fhotelling)[names(fhotelling) == "sitc_aggr"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="partner_grouping_8"){
names(fhotelling)[names(fhotelling) == "partner_grouping_8"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
}
fhotelling = mutate(fhotelling, pour_calcul_national = best_guess_national_partner*value)
fhotelling = fhotelling %>% group_by(year, export_import) %>% mutate(commerce_national = sum(pour_calcul_national, na.rm = TRUE))
fhotelling$pour_calcul_national = NULL
fhotelling$source_tout_region_one = ifelse(
(fhotelling$source_type=="National toutes directions tous partenaires" |
fhotelling$source_type=="National toutes directions sans produits"), 1, 0)
fhotelling = fhotelling %>% group_by(year) %>%
mutate(source_tout_region = max(source_tout_region_one, na.rm = TRUE))
fhotelling = fhotelling[(fhotelling$source_tout_region==1 &
fhotelling$source_type != "National toutes directions tous partenaires" &
fhotelling$source_type !="National toutes directions sans produits"),]
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
fhotelling = hotelling
if(period=="pre1795") fhotelling = fhotelling[fhotelling$year<1795,]
if(direction=="national"){
if(classification=="sitc"){
names(fhotelling)[names(fhotelling) == "product_sitc_simplEN"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="sitc_aggr"){
names(fhotelling)[names(fhotelling) == "sitc_aggr"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="partner_grouping_8"){
names(fhotelling)[names(fhotelling) == "partner_grouping_8"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
}
fhotelling = mutate(fhotelling, pour_calcul_national = best_guess_national_partner*value)
fhotelling = fhotelling %>% group_by(year, export_import) %>% mutate(commerce_national = sum(pour_calcul_national, na.rm = TRUE))
fhotelling$pour_calcul_national = NULL
#Keeping nationl by region when available
fhotelling$source_tout_region_one = ifelse(
(fhotelling$source_type=="National toutes directions tous partenaires" |
fhotelling$source_type=="National toutes directions sans produits"), 1, 0)
fhotelling = fhotelling %>% group_by(year) %>%
mutate(source_tout_region = max(source_tout_region_one, na.rm = TRUE))
summary(fhotelling$source_tout_region)
nrow(fhotelling[fhotelling$source_tout_region==1,])
with(fhotelling, which((source_tout_region==1 & source_type != "National toutes directions tous partenaires" & source_type !="National toutes directions sans produits"), arr.ind=TRUE))
with(fhotelling, which((best_guess_region_prodxpart !=1 & source_tout_region!=1 & year!=1789), arr.ind=TRUE))
with(fhotelling, which((best_guess_region_prodxpart !=1))
)
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
fhotelling = hotelling
fhotelling = mutate(fhotelling, pour_calcul_national = best_guess_national_partner*value)
fhotelling = fhotelling %>% group_by(year, export_import) %>% mutate(commerce_national = sum(pour_calcul_national, na.rm = TRUE))
fhotelling$pour_calcul_national = NULL
#Keeping nationl by region when available
fhotelling$source_tout_region_one = ifelse(
(fhotelling$source_type=="National toutes directions tous partenaires" |
fhotelling$source_type=="National toutes directions sans produits"), 1, 0)
fhotelling = fhotelling %>% group_by(year) %>%
mutate(source_tout_region = max(source_tout_region_one, na.rm = TRUE))
fhotelling =
fhotelling[!(source_tout_region==1 &
source_type != "National toutes directions tous partenaires" &
source_type !="National toutes directions sans produits"),]
fhotelling =
fhotelling[!(fhotelling$source_tout_region==1 &
fhotelling$source_type != "National toutes directions tous partenaires" &
fhotelling$source_type !="National toutes directions sans produits"),]
fhotelling = fhotelling[!(fhotelling$best_guess_region_prodxpart !=1 &
fhotelling$source_tout_region!=1 &
fhotelling$year!=1789),]
fhotelling = fhotelling[!(fhotelling$year==1789 &
fhotelling$best_guess_national_region ==0),]
fhotelling = fhotelling[!(fhotelling$year==1789 &
fhotelling$customs_region =="Nantes"),]
fhotelling = fhotelling[!(fhotelling$best_guess_region_prodxpart !=1 &
fhotelling$source_tout_region!=1 &
fhotelling$year!=1789),]
fhotelling = fhotelling[!(fhotelling$best_guess_region_prodxpart !=1 &
fhotelling$source_tout_region!=1),]
fhotelling = fhotelling[!(fhotelling$source_tout_region!=1 &
fhotelling$year!=1789),]
fhotelling = fhotelling[!(fhotelling$year==1789 &
fhotelling$best_guess_national_region ==0),]
fhotelling = fhotelling[!(fhotelling$year==1789 &
fhotelling$customs_region =="Nantes"),]
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
fhotelling = hotelling
if(direction=="national"){
if(classification=="sitc"){
names(fhotelling)[names(fhotelling) == "product_sitc_simplEN"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="sitc_aggr"){
names(fhotelling)[names(fhotelling) == "sitc_aggr"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="partner_grouping_8"){
names(fhotelling)[names(fhotelling) == "partner_grouping_8"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
}
fhotelling = mutate(fhotelling, pour_calcul_national = best_guess_national_partner*value)
fhotelling = fhotelling %>% group_by(year, export_import) %>% mutate(commerce_national = sum(pour_calcul_national, na.rm = TRUE))
fhotelling$pour_calcul_national = NULL
fhotelling$source_tout_region_one = ifelse(
(fhotelling$source_type=="National toutes directions tous partenaires" |
fhotelling$source_type=="National toutes directions sans produits"), 1, 0)
fhotelling = fhotelling %>% group_by(year) %>%
mutate(source_tout_region = max(source_tout_region_one, na.rm = TRUE))
fhotelling[!(fhotelling$source_tout_region==1 &
fhotelling$source_type != "National toutes directions tous partenaires" &
fhotelling$source_type !="National toutes directions sans produits"),]
fhotelling =
fhotelling[!(fhotelling$source_tout_region==1 &
fhotelling$source_type != "National toutes directions tous partenaires" &
fhotelling$source_type !="National toutes directions sans produits"),]
fhotelling = fhotelling[!(fhotelling$best_guess_region_prodxpart !=1 &
fhotelling$source_tout_region!=1 &
fhotelling$year!=1789),]
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
fhotelling = hotelling
if(period=="pre1795") fhotelling = fhotelling[fhotelling$year<1795,]
if(direction=="national"){
if(classification=="sitc"){
names(fhotelling)[names(fhotelling) == "product_sitc_simplEN"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="sitc_aggr"){
names(fhotelling)[names(fhotelling) == "sitc_aggr"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="partner_grouping_8"){
names(fhotelling)[names(fhotelling) == "partner_grouping_8"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
}
fhotelling = mutate(fhotelling, pour_calcul_national = best_guess_national_partner*value)
fhotelling = fhotelling %>% group_by(year, export_import) %>% mutate(commerce_national = sum(pour_calcul_national, na.rm = TRUE))
fhotelling$pour_calcul_national = NULL
fhotelling$source_tout_region_one = ifelse(
(fhotelling$source_type=="National toutes directions tous partenaires" |
fhotelling$source_type=="National toutes directions sans produits"), 1, 0)
fhotelling = fhotelling %>% group_by(year) %>%
mutate(source_tout_region = max(source_tout_region_one, na.rm = TRUE))
fhotelling =
fhotelling[!(fhotelling$source_tout_region==1 &
fhotelling$source_type != "National toutes directions tous partenaires" &
fhotelling$source_type !="National toutes directions sans produits"),]
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
fhotelling = hotelling
rm(list = ls())
library(dplyr)
library(ggplot2)
library(ggpubr)
library(extrafont)
library(ggthemes)
library(tidyverse)
library(whoami)
library(zoo)
loadfonts()
if(username()=="Tirindelli"){
HamburgPaperDir = "/Users/Tirindelli/Desktop/HamburgPaper/"
HamburgDir = "/Volumes/GoogleDrive/My Drive/Hamburg/"
}
RscriptDir = "Do-files/Rscripts/"
GraphDir = "Graphs/"
DataframeDir = "Dataframe/"
NewgraphsDir = "New graphs/"
PaperDir = "Paper - Impact of War/Paper/"
loss = read.csv(paste(HamburgDir,"database_csv/mean_annual_loss.csv", sep = ""))
loss = loss[c("year", "loss", "loss_nomemory" )]
colony_loss = read.csv(paste(HamburgDir,"database_csv/colony_loss.csv", sep = ""))
colony_loss = colony_loss[c("year", "weight_france")]
naval_sup = read.csv(paste(HamburgDir,"database_csv/naval_supremacy.csv", sep = ""))
naval_sup = naval_sup[c("year", "France_vs_GB", "ally_vs_foe", "allyandneutral_vs_foe")]
prizes = read.csv(paste(HamburgDir,"database_csv/prizes.csv", sep = ""))
prizes = prizes[c("year", "Number_of_prizes_Total_All",
"Number_of_prizes_Privateers_All", "importofprizegoodspoundsterling")]
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
war_strat = left_join(loss, colony_loss, by = "year")
war_strat = left_join(war_strat, naval_sup, by = "year")
war_strat = left_join(war_strat, prizes, by = "year")
names(war_strat)[names(war_strat) == "importofprizegoodspoundsterling"] = "prizes_import"
names(war_strat)[names(war_strat) == "Number_of_prizes_Total_All"] = "num_prizes"
names(war_strat)[names(war_strat) == "Number_of_prizes_Privateers_All"] = "num_prizes_priv"
names(war_strat)[names(war_strat) == "weight_france"] = "colony_loss"
fwartime_corr_df = function(fwar_strat, findep){
names(fwar_strat)[names(fwar_strat) == findep] = "findep"
m = lm(fwar_strat$loss~fwar_strat$findep)
df = data.frame(
"var" = findep,
"corr" = round(m$coefficients[2], 3),
"pval" = round(summary(m)$coefficients[2,4], 3)
)
}
indep_var = c("prizes_import", "num_prizes", "num_prizes_priv", "colony_loss", "France_vs_GB",
"ally_vs_foe", "allyandneutral_vs_foe")
dflist = list(
fwartime_corr_df(war_strat, "prizes_import"),
fwartime_corr_df(war_strat, "num_prizes"),
fwartime_corr_df(war_strat, "num_prizes_priv"),
fwartime_corr_df(war_strat, "colony_loss"),
fwartime_corr_df(war_strat, "France_vs_GB"),
fwartime_corr_df(war_strat, "ally_vs_foe"),
fwartime_corr_df(war_strat, "allyandneutral_vs_foe")
)
wartime_corr = bind_rows(dflist)
View(wartime_corr)
View(wartime_corr)
Dwar_strat = war_strat
Dwar_strat$Wcut= cut(Dwar_strat$year,
breaks=c(1739,1748,1755,1763,1777,1783, 1792, 1807,1815, 1840),
labels = FALSE)
Dwar_strat$war = ifelse(((Dwar_strat$Wcut %% 2) == 0), 0, 1)
Dwar_strat$war = ifelse((Dwar_strat$Wcut == 9), 0, Dwar_strat$war)
Dwar_strat$war = ifelse((Dwar_strat$Wcut == 8), 1, Dwar_strat$war)
Dwar_strat = Dwar_strat %>% group_by(Wcut) %>% mutate(counter = row_number())
f = function(x){
x = na.locf(x)
x = ifelse(Dwar_strat$war ==0, x*exp(-Dwar_strat$counter), x)
}
Dwar_strat[indep_var] = lapply(Dwar_strat[indep_var], f)
dflist = list(
fwartime_corr_df(Dwar_strat, "prizes_import"),
fwartime_corr_df(Dwar_strat, "num_prizes"),
fwartime_corr_df(Dwar_strat, "num_prizes_priv"),
fwartime_corr_df(Dwar_strat, "colony_loss"),
fwartime_corr_df(Dwar_strat, "France_vs_GB"),
fwartime_corr_df(Dwar_strat, "ally_vs_foe"),
fwartime_corr_df(Dwar_strat, "allyandneutral_vs_foe")
)
Dwartime_corr = bind_rows(dflist)
View(Dwartime_corr)
View(wartime_corr)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(extrafont)
library(ggthemes)
library(tidyverse)
library(whoami)
library(zoo)
loadfonts()
if(username()=="Tirindelli"){
HamburgPaperDir = "/Users/Tirindelli/Desktop/HamburgPaper/"
HamburgDir = "/Volumes/GoogleDrive/My Drive/Hamburg/"
}
RscriptDir = "Do-files/Rscripts/"
GraphDir = "Graphs/"
DataframeDir = "Dataframe/"
NewgraphsDir = "New graphs/"
PaperDir = "Paper - Impact of War/Paper/"
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
fhotelling = hotelling
if(period=="pre1795") fhotelling = fhotelling[fhotelling$year<1795,]
if(direction=="national"){
if(classification=="sitc"){
names(fhotelling)[names(fhotelling) == "product_sitc_simplEN"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="sitc_aggr"){
names(fhotelling)[names(fhotelling) == "sitc_aggr"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="partner_grouping_8"){
names(fhotelling)[names(fhotelling) == "partner_grouping_8"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
}
library(dplyr)
library(ggplot2)
library(ggpubr)
library(extrafont)
library(ggthemes)
library(tidyverse)
library(whoami)
library(zoo)
loadfonts()
if(username()=="Tirindelli"){
HamburgPaperDir = "/Users/Tirindelli/Desktop/HamburgPaper/"
HamburgDir = "/Volumes/GoogleDrive/My Drive/Hamburg/"
}
RscriptDir = "Do-files/Rscripts/"
GraphDir = "Graphs/"
DataframeDir = "Dataframe/"
NewgraphsDir = "New graphs/"
PaperDir = "Paper - Impact of War/Paper/"
rm(list = ls())
library(dplyr)
library(ggplot2)
library(ggpubr)
library(extrafont)
library(ggthemes)
library(tidyverse)
library(whoami)
library(zoo)
loadfonts()
if(username()=="Tirindelli"){
HamburgPaperDir = "/Users/Tirindelli/Desktop/HamburgPaper/"
HamburgDir = "/Volumes/GoogleDrive/My Drive/Hamburg/"
}
RscriptDir = "Do-files/Rscripts/"
GraphDir = "Graphs/"
DataframeDir = "Dataframe/"
NewgraphsDir = "New graphs/"
PaperDir = "Paper - Impact of War/Paper/"
hotelling = read.csv(paste(HamburgDir,"database_csv/temp_for_hotelling.csv", sep = ""))
fhotelling = hotelling
direction = "national"
X_I = "X"
classification = "sitc"
period = ""
if(period=="pre1795") fhotelling = fhotelling[fhotelling$year<1795,]
if(direction=="national"){
if(classification=="sitc"){
names(fhotelling)[names(fhotelling) == "product_sitc_simplEN"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="sitc_aggr"){
names(fhotelling)[names(fhotelling) == "sitc_aggr"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
if(classification=="partner_grouping_8"){
names(fhotelling)[names(fhotelling) == "partner_grouping_8"] = "class"
fhotelling = fhotelling[fhotelling$best_guess_national_product==1,]
}
}
if(direction=="regional"){
#Computing total trade
fhotelling = mutate(fhotelling, pour_calcul_national = best_guess_national_partner*value)
fhotelling = fhotelling %>% group_by(year, export_import) %>% mutate(commerce_national = sum(pour_calcul_national, na.rm = TRUE))
fhotelling$pour_calcul_national = NULL
#Keeping nationl by region when available
fhotelling$source_tout_region_one = ifelse(
(fhotelling$source_type=="National toutes directions tous partenaires" |
fhotelling$source_type=="National toutes directions sans produits"), 1, 0)
fhotelling = fhotelling %>% group_by(year) %>%
mutate(source_tout_region = max(source_tout_region_one, na.rm = TRUE))
fhotelling =
fhotelling[!(fhotelling$source_tout_region==1 &
fhotelling$source_type != "National toutes directions tous partenaires" &
fhotelling$source_type !="National toutes directions sans produits"),]
#Keeping best_guess_region_prodxpart (or the next best thing for 1789) otherwise.
#Nantes is 1789 is not complete
fhotelling = fhotelling[!(fhotelling$best_guess_region_prodxpart !=1 &
fhotelling$source_tout_region!=1 &
fhotelling$year!=1789),]
fhotelling = fhotelling[!(fhotelling$year==1789 &
fhotelling$best_guess_national_region ==0),]
fhotelling = fhotelling[!(fhotelling$year==1789 &
fhotelling$customs_region =="Nantes"),]
#Various
fhotelling = fhotelling[fhotelling$year!=1714,]
#Now to compute the share of trade
fhotelling = fhotelling %>% group_by(customs_region_grouping, export_import,
year, commerce_national, period_str, war) %>%
summarise(value = sum(value, na.rm = TRUE))
fhotelling = fhotelling %>% mutate(percent=value/commerce_national)
fhotelling = fhotelling[!(fhotelling$customs_region_grouping =="France" |
fhotelling$customs_region_grouping =="Colonies Françaises de l'Amérique"  |
fhotelling$customs_region_grouping =="" ),]
names(fhotelling)[names(fhotelling) == "customs_region_grouping"] = "regional"
fhotelling$regional = ifelse(fhotelling$regional=="Saint-Quentin", "Saint_Quentin", fhotelling$regional)
fhotelling = fhotelling[!(fhotelling$regional=="Charleville" |  fhotelling$regional=="La Rochelle" |
fhotelling$regional=="Langres" | fhotelling$regional=="Rouen" |
fhotelling$regional=="Montpellier" | fhotelling$regional=="Narbonne"),]
#There is no usefull results for these
}
direction = "regional"
if(direction=="regional"){
#Computing total trade
fhotelling = mutate(fhotelling, pour_calcul_national = best_guess_national_partner*value)
fhotelling = fhotelling %>% group_by(year, export_import) %>% mutate(commerce_national = sum(pour_calcul_national, na.rm = TRUE))
fhotelling$pour_calcul_national = NULL
#Keeping nationl by region when available
fhotelling$source_tout_region_one = ifelse(
(fhotelling$source_type=="National toutes directions tous partenaires" |
fhotelling$source_type=="National toutes directions sans produits"), 1, 0)
fhotelling = fhotelling %>% group_by(year) %>%
mutate(source_tout_region = max(source_tout_region_one, na.rm = TRUE))
fhotelling =
fhotelling[!(fhotelling$source_tout_region==1 &
fhotelling$source_type != "National toutes directions tous partenaires" &
fhotelling$source_type !="National toutes directions sans produits"),]
#Keeping best_guess_region_prodxpart (or the next best thing for 1789) otherwise.
#Nantes is 1789 is not complete
fhotelling = fhotelling[!(fhotelling$best_guess_region_prodxpart !=1 &
fhotelling$source_tout_region!=1 &
fhotelling$year!=1789),]
fhotelling = fhotelling[!(fhotelling$year==1789 &
fhotelling$best_guess_national_region ==0),]
fhotelling = fhotelling[!(fhotelling$year==1789 &
fhotelling$customs_region =="Nantes"),]
#Various
fhotelling = fhotelling[fhotelling$year!=1714,]
#Now to compute the share of trade
fhotelling = fhotelling %>% group_by(customs_region_grouping, export_import,
year, commerce_national, period_str, war) %>%
summarise(value = sum(value, na.rm = TRUE))
fhotelling = fhotelling %>% mutate(percent=value/commerce_national)
fhotelling = fhotelling[!(fhotelling$customs_region_grouping =="France" |
fhotelling$customs_region_grouping =="Colonies Françaises de l'Amérique"  |
fhotelling$customs_region_grouping =="" ),]
names(fhotelling)[names(fhotelling) == "customs_region_grouping"] = "regional"
fhotelling$regional = ifelse(fhotelling$regional=="Saint-Quentin", "Saint_Quentin", fhotelling$regional)
fhotelling = fhotelling[!(fhotelling$regional=="Charleville" |  fhotelling$regional=="La Rochelle" |
fhotelling$regional=="Langres" | fhotelling$regional=="Rouen" |
fhotelling$regional=="Montpellier" | fhotelling$regional=="Narbonne"),]
#There is no usefull results for these
}
fhotelling = cbind(fhotelling, source="x")
fhotelling = hotelling
fhotelling = cbind(fhotelling, source="x")
View(hotelling)
View(fhotelling)
